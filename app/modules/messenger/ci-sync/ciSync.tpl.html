<div ng-if="!sync.authorized()">
  <span class="icon icon-warning"></span>
  <span translate="messengerCiSync.errorUnauthorizedToView"></span>
</div>

<div class="container-ci-sync settings" ng-if="sync.authorized()">

  <cs-page-header title-name="{{'messengerCiSync.pageTitle' | translate}}" back="true" back-url="sync.backState"></cs-page-header>

  <div class="container-ci-sync__content-body">
    <div ng-if="sync.dataStates.LOADING === sync.dataStatus">
      <span class="icon icon-spinner"></span>
      <span translate="messengerCiSync.loading"></span>
    </div>

    <div ng-if="sync.dataStates.ERROR === sync.dataStatus">
      <span class="icon icon-warning"></span>
      <span>{{sync.errorMsg}}</span>
      <p class="down-10">
        <span ng-click="sync.refreshStatus()" class="right-5">
          <i class="icon icon-refresh"></i> {{sync.refresh}}
        </span>
      </p>
    </div>

    <div ng-if="sync.dataStates.LOADED === sync.dataStatus">
      <setting-section setting="sync.subSections.orgInfo" class="org-info-section">
        <div class="row row--first">
          <div class="medium-6">
            <input cs-input type="text"
              id="ciSyncOrgSettingsOrgName"
              name="ciSyncOrgSettingsOrgName"
              ng-model="sync.settings.syncInfo.messengerOrgName"
              cs-input-label="{{:: 'messengerCiSync.orgInfoSection.name' | translate }}"
              disabled
              read-only>
          </div>
          <div class="medium-6"></div>
        </div>
        <div class="row">
          <div class="medium-6">
            <input cs-input type="text"
              id="ciSyncOrgSettingsOrgId"
              name="ciSyncOrgSettingsOrgId"
              ng-model="sync.settings.syncInfo.messengerOrgId"
              cs-input-label="{{:: 'messengerCiSync.orgInfoSection.id' | translate }}"
              disabled
              read-only>
          </div>
          <div class="medium-6"></div>
        </div>
        <div class="row">
          <div class="medium-6">
            <input cs-input type="text"
              id="ciSyncOrgSettingsCiLinkDate"
              name="ciSyncOrgSettingsCiLinkDate"
              ng-model="sync.settings.syncInfo.linkDate"
              cs-input-label="{{:: 'messengerCiSync.orgInfoSection.linkDate' | translate }}"
              disabled
              read-only>
          </div>
          <div class="medium-6"></div>
        </div>
        <div class="row links-row">
          <div class="medium-12">
            <span ng-click="sync.refreshStatus()" class="right-5">
              <i class="icon icon-refresh"></i> {{sync.refresh}}
            </span>
            |
            <span>
              <a
                href="{{sync.orgAdminUrl}}"
                target="_blank"
                tooltip-placement="left"
                tooltip="{{sync.orgAdminLinkTooltip}}"
                tooltip-trigger="mouseenter focus"
                translate="messengerCiSync.orgAdminLinkText"
                aria-label="{{::'messengerCiSync.orgAdminLinkText' | translate}} {{sync.orgAdminLinkTooltip}}">
                <!-- aria-label must include both the link text and the tooltip text -->
              </a>
            </span>
          </div>
        </div>
      </setting-section>

      <setting-section setting="sync.subSections.options" class="options-section">
        <div cr-feature-toggle feature-show="atlas-jabber-interop" class="row row--first">
          <span tabindex="0"
            tooltip="{{sync.jabberInteropTooltip}}"
            tooltip-trigger="mouseenter focus"
            translate="messengerCiSync.jabberInteropHeading"
            aria-label="{{::'messengerCiSync.jabberInteropHeading' | translate}} {{sync.jabberInteropTooltip}}">
            <!-- aria-label must include both the link text and the tooltip text -->
          </span>
          <toggle-switch-with-read-only
            value="sync.settings.jabberInterop"
            toggle-id="toggleJabberInterop"
            on-change-fn="sync.setExistingProperty('settings.jabberInterop', toggleValue);"
            cs-aria-label="{{::'messengerCiSync.jabberInteropHeading' | translate}}">
          </toggle-switch-with-read-only>
        </div>

        <div ng-if="sync.settings.syncInfo.isMessengerSyncRawMode" class="row"> <!-- Native Messenger Sync mode -->
          <span tabindex="0"
            tooltip-placement="top"
            tooltip="{{sync.syncStatusTooltip}}"
            tooltip-trigger="mouseenter focus"
            translate="messengerCiSync.syncStatusHeading"
            aria-label="{{::'messengerCiSync.syncStatusHeading' | translate}} {{sync.syncStatusTooltip}}">
            <!-- aria-label must include both the link text and the tooltip text -->
          </span>
          <toggle-switch-with-read-only
            value="sync.settings.syncInfo.isSyncEnabled"
            is-read-only="!sync.isOpsAdmin()"
            toggle-id="toggleIsSyncing"
            on-change-fn="sync.setExistingProperty('settings.syncInfo.isSyncEnabled', toggleValue);"
            cs-aria-label="{{::'messengerCiSync.syncStatusHeading' | translate}}">
          </toggle-switch-with-read-only>
        </div>

        <div ng-if="!sync.settings.syncInfo.isMessengerSyncRawMode" class="row"> <!-- Native CI DirSync mode -->
          <span tabindex="0"
            tooltip-placement="top"
            tooltip="{{sync.dirsyncStatusTooltip}}"
            tooltip-trigger="mouseenter focus"
            translate="messengerCiSync.dirsyncStatusHeading"
            aria-label="{{::'messengerCiSync.dirsyncStatusHeading' | translate}} {{sync.dirsyncStatusTooltip}}">
            <!-- aria-label must include both the link text and the tooltip text -->
          </span>
          <boolean-text-field value="sync.settings.syncInfo.isSyncEnabled"></boolean-text-field>
        </div>

        <div class="row">
          <span tabindex="0"
            tooltip-placement="top"
            tooltip="{{sync.authRedirectTooltip}}"
            tooltip-trigger="mouseenter focus"
            translate="messengerCiSync.authRedirectHeading"
            aria-label="{{::'messengerCiSync.authRedirectHeading' | translate}} {{sync.authRedirectTooltip}}">
            <!-- aria-label must include both the link text and the tooltip text -->
          </span>
          <toggle-switch-with-read-only
            value="sync.settings.syncInfo.isAuthRedirect"
            is-read-only="!sync.isOpsAdmin()"
            toggle-id="toggleAuthRedirect"
            on-change-fn="sync.setExistingProperty('settings.syncInfo.isAuthRedirect', toggleValue);"
            cs-aria-label="{{::'messengerCiSync.authRedirectHeading' | translate}}">
          </toggle-switch-with-read-only>
        </div>

        <div ng-if="sync.settings.syncInfo.isNewDataFormat"> <!-- new org ext data -->
          <div class="row">
            <span tabindex="0"
              tooltip-placement="top"
              tooltip="{{sync.pwdSyncTooltip}}"
              tooltip-trigger="mouseenter focus"
              translate="messengerCiSync.pwdSyncHeading"
              aria-label="{{::'messengerCiSync.pwdSyncHeading' | translate}} {{sync.pwdSyncTooltip}}">
              <!-- aria-label must include both the link text and the tooltip text -->
            </span>
            <toggle-switch-with-read-only
              value="sync.settings.syncInfo.isPwdSync"
              is-read-only="!sync.isOpsAdmin()"
              toggle-id="tidPwdSync"
              on-change-fn="sync.setExistingProperty('settings.syncInfo.isPwdSync', toggleValue);"></toggle-switch-with-read-only>
          </div>

          <div class="row">
            <span tabindex="0"
              tooltip-placement="top"
              tooltip="{{sync.sparkEntTooltip}}"
              tooltip-trigger="mouseenter focus"
              translate="messengerCiSync.sparkEntHeading"
              aria-label="{{::'messengerCiSync.sparkEntHeading' | translate}} {{sync.sparkEntTooltip}}">
              <!-- aria-label must include both the link text and the tooltip text -->
            </span>
            <toggle-switch-with-read-only
              value="sync.settings.syncInfo.isSparkEnt"
              is-read-only="!sync.isOpsAdmin()"
              toggle-id="tidSparkEnt"
              on-change-fn="sync.setExistingProperty('settings.syncInfo.isSparkEnt', toggleValue);"
              cs-aria-label="{{::'messengerCiSync.sparkEntHeading' | translate}}">
            </toggle-switch-with-read-only>
          </div>

          <div class="row">
            <span tabindex="0"
              tooltip-placement="top"
              tooltip="{{sync.usrDisTooltip}}"
              tooltip-trigger="mouseenter focus"
              translate="messengerCiSync.usrDisHeading"
              aria-label="{{::'messengerCiSync.usrDisHeading' | translate}} {{sync.usrDisTooltip}}">
              <!-- aria-label must include both the link text and the tooltip text -->
            </span>
            <toggle-switch-with-read-only
              value="sync.settings.syncInfo.isUsrDis"
              is-read-only="!sync.isOpsAdmin()"
              toggle-id="tidUsrDis"
              on-change-fn="sync.setExistingProperty('settings.syncInfo.isUsrDis', toggleValue);"
              cs-aria-label="{{::'messengerCiSync.usrDisHeading' | translate}}">
            </toggle-switch-with-read-only>
          </div>

          <div class="row">
            <span tabindex="0"
              tooltip-placement="top"
              tooltip="{{sync.usrDelTooltip}}"
              tooltip-trigger="mouseenter focus"
              translate="messengerCiSync.usrDelHeading"
              aria-label="{{::'messengerCiSync.usrDelHeading' | translate}} {{sync.usrDelTooltip}}">
              <!-- aria-label must include both the link text and the tooltip text -->
            </span>
            <toggle-switch-with-read-only
              value="sync.settings.syncInfo.isUsrDel"
              is-read-only="!sync.isOpsAdmin()"
              toggle-id="tidUsrDel"
              on-change-fn="sync.setExistingProperty('settings.syncInfo.isUsrDel', toggleValue);"
              cs-aria-label="{{::'messengerCiSync.usrDelHeading' | translate}}">
            </toggle-switch-with-read-only>
          </div>
        </div>

      </setting-section>
    </div>
  </div>

  <div class="save-cancel-footer" ng-if="sync.canShowSaveCancel()">
    <button type="button" cs-btn loading="sync.isSaving" class="btn btn--primary save-cancel-buttons pull-right" ng-click="sync.saveSettings()">
      <span translate="common.save"></span>
    </button>
    <button type="button" class="btn save-cancel-buttons pull-right" translate="common.cancel" ng-click="sync.resetSettings()"></button>
  </div>

</div>

<div ng-if="$ctrl.loading" class="text-center spinner-container">
  <i class="icon icon-spinner icon-2x"></i>
</div>

<div class="none_found" ng-if="!$ctrl.loading && $ctrl.data.nodes.length === 0">
  <i class="icon icon-circle-data"></i>
  <span class="h2" translate="hercules.nodesPage.noNodes"></span>
</div>

<div ng-if="!$ctrl.loading && $ctrl.data.nodes.length > 0 && $ctrl.nextUpgradeStartTime">
  <cs-alert-banner type="info" closeable="true" ng-if="$ctrl.connectorTypesWithUpgrade.length > 0">
    <span
      translate="hercules.nodesPage.alertBannerNumber"
      translate-value-count="{{$ctrl.connectorTypesWithUpgrade.length}}"
      translate-interpolation="messageformat"
    ></span>
    <span
      translate="hercules.nodesPage.alertBannerTime"
      translate-value-date="{{$ctrl.nextUpgradeStartTime}}"
    ></span>
    <span
      translate="hercules.nodesPage.alertBannerLink"
      translate-value-onclick="$ctrl.openUpgradeModal()"
      translate-compile
    ></span>
  </cs-alert-banner>
  <table>
    <thead>
      <tr>
        <th scope="col" translate="hercules.nodesPage.connectors"></th>
        <th scope="col" translate="hercules.nodesPage.status"></th>
        <th scope="col" translate="hercules.nodesPage.version"></th>
      </tr>
    </thead>
    <tbody ng-repeat="node in $ctrl.data.nodes | orderBy:'name' track by node.serial">
      <tr class="hostname">
        <td colspan="4">
          <span class="nodename">{{::node.name}}</span>
          <div class="pull-right">
            <span ng-if="node.platformVersion !== 'unknown'" class="node-serial" translate="hercules.nodesPage.platformVersion" translate-value-version="{{::node.platformVersion}}"></span>
            <span class="node-serial" translate="hercules.nodesPage.serial" translate-value-serial="{{::node.serial}}"></span>
            <span cs-dropdown>
              <button cs-dropdown-toggle class="actions-button btn--link dropdown-toggle" translate="common.actions"></button>
              <ul cs-dropdown-menu class="dropdown-menu dropdown-primary actions-services">
                <li ng-if="$ctrl.displayMaintenanceModeMenuItem($ctrl.data.targetType) && node.maintenanceMode === 'off'">
                  <a ng-click="$ctrl.enableMaintenanceMode(node)">
                    <span translate="hercules.nodesPage.enableMaintenanceMode"></span>
                    <i class="icon icon-question-circle" tooltip-placement="left" tooltip="{{::'hercules.nodesPage.maintenanceModeTooltip' | translate}}" tooltip-append-to-body="true"></i>
                  </a>
                </li>
                <li ng-if="$ctrl.displayMaintenanceModeMenuItem($ctrl.data.targetType) && node.maintenanceMode !== 'off'">
                  <a ng-click="$ctrl.disableMaintenanceMode(node)">
                    <span translate="hercules.nodesPage.disableMaintenanceMode"></span>
                  </a>
                </li>
                <li ng-if="$ctrl.displayGoToNodeMenuItem($ctrl.data.targetType)">
                  <a target="_blank" ng-href="https://{{::node.name}}/">
                    <span translate="hercules.nodesPage.goToNode"></span>
                  </a>
                </li>
                <li ng-if="$ctrl.displayMoveNodeMenuItem($ctrl.data.targetType)">
                  <a ng-click="$ctrl.openMoveNodeModal(node)">
                    <span translate="hercules.nodesPage.moveNode"></span>
                  </a>
                </li>
                <li ng-if="$ctrl.displayDeregisterNodeMenuItem($ctrl.data.targetType)">
                  <a ng-click="$ctrl.openDeregisterNodeModal(node)">
                    <span translate="hercules.nodesPage.deregisterNode"></span>
                  </a>
                </li>
              </ul>
            </span>
          </div>
        </td>
      </tr>
      <tr class="connector-row" ng-repeat="connector in node.connectors | orderBy:'connectorType':false:$ctrl.hybridConnectorsComparator" ng-click="$ctrl.openSidepanel(connector)" ng-class="{'active': $ctrl.isSidepanelOpen(connector)}">
        <td>{{::connector.service}}</td>
        <td>
          <cs-statusindicator ng-model="connector.status.cssClass"></cs-statusindicator>
          <span class="status">{{::connector.statusName}}</span>
          <span class="badge warning" ng-if="connector.maintenanceMode === 'on'" translate="hercules.fusion.list.maintenance"></span>
          <span class="badge" ng-if="connector.maintenanceMode === 'pending'" translate="hercules.fusion.list.pendingMaintenance"
                tooltip="{{::node.pendingTooltip}}" tooltip-trigger="mouseenter" tooltip-placement="top"></span>
          <span class="badge info" ng-if="connector.hasUpgradeAvailable" translate="hercules.fusion.list.upgrade"></span>
          <span class="badge" ng-if="connector.upgradeState === 'upgrading'" translate="hercules.fusion.list.upgrading"></span>
          <span class="badge" ng-if="connector.upgradeState === 'pending'" translate="hercules.fusion.list.pending"></span>
        </td>
        <td>{{::connector.version}}</td>
      </tr>
      <tr class="connector-row-filler" ng-if="!$last"><td colspan="3"></td></tr>
    </tbody>
  </table>
</div>

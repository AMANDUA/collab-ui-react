<div ng-if="$ctrl.loading" class="load">
  <i class='icon icon-spinner'></i>
</div>
<cs-page-header title="{{$ctrl.pg.name}}" back="$ctrl.back" back-url="$ctrl.huronFeaturesUrl"></cs-page-header>
<script type="text/ng-template" id="userTemplate.html">
  <a>
    <span ng-bind-html="match.label | typeaheadHighlight:query"></span>
  </a>
</script>

<div class="save-section pg-save" ng-if="$ctrl.formChanged">
  <p>{{:: 'pagingGroup.saveLabel' | translate}}</p>
  <button ng-click="$ctrl.onCancel()">{{:: 'common.cancel' | translate}}</button>
  <button class="btn btn--primary" cs-btn loading="$ctrl.saveInProgress" ng-click="$ctrl.saveForm()" ng-disabled="$ctrl.showDisableSave()">{{:: 'common.save' | translate}}
  </button>
</div>

<div ng-if="!$ctrl.loading" class="pg-edit">
  <form novalidate name="$ctrl.form" role="form" class="cs-form">
    <div class="cs-form__section cs-form__section--first">
      <div class="section__info">
        <h4 class="section__title" translate="pagingGroup.pagingGroupName"></h4>
        <h6 class="section__description" translate="pagingGroup.nameHint"></h6>
      </div>
      <div class="section__content">
        <div ng-class="{'error': $ctrl.errorNameInput}">
          <input id="paging-group-name" type="text" required="required" class="cs-input" ng-model="$ctrl.name" ng-change="$ctrl.onChange()"
          />
        </div>
      </div>
    </div>
    <div class="cs-form__section">
      <div class="section__info">
        <h4 class="section__title" translate="pagingGroup.pagingGroupNumber"></h4>
        <h6 class="section__description" translate="pagingGroup.numberHint"></h6>
      </div>
      <div class="section__content">
        <cs-select ng-model="$ctrl.number" options="$ctrl.availableNumbers" labelfield="number" filter="true" refresh-data-fn="$ctrl.fetchNumbers(filter)"
          ng-change="$ctrl.onChange()">
        </cs-select>
      </div>
    </div>
    <div class="cs-form__section cs-form__section--member">
      <div class="section__info">
        <h4 class="section__title" translate="pagingGroup.pagingGroupMembers"></h4>
        <h6 class="section__description" translate="pagingGroup.memberEditHint"></h6>
      </div>
      <div class="section__content">
        <div class="pg-search-add">
          <input id="paging-group-member" type="text" ng-click="$ctrl.resetFilter()" ng-model="$ctrl.memberName"class="cs-input"
            typeahead="mem as $ctrl.getDisplayNameInDropdown(mem) for mem in $ctrl.fetchMembers('MEMBER') | limitTo:10" typeahead-template-url="userTemplate.html"
            typeahead-on-select="$ctrl.selectMembers($item)" placeholder="{{:: 'pagingGroup.editMemberPlaceholder' | translate}}"
            typeahead-min-length="3" typeahead-wait-ms="300">
          <div class="search-member">
            <i class="icon icon-search"></i>
            <input id="search-member-box" type="text" placeholder="{{'pagingGroup.search' | translate}}" ng-model="$ctrl.searchStr" ng-change="$ctrl.filterList()">
          </div>
        </div>
        <h5 class="sub-section__label" translate='common.users'></h5>
        <div>
          <cs-card-layout>
            <cs-card-member
              ng-repeat="member in $ctrl.listOfDisplayMembers | filter: {member: {'type': 'USER_REAL_USER'}} | limitTo:$ctrl.numberOfCardsUsers"
              cs-type="simple"
              cs-member-type="{{$ctrl.getMemberType(member.member)}}"
              cs-id="member.member.uuid"
              cs-title="$ctrl.getDisplayNameOnCard(member.member)"
              cs-subtitle="member.member.userName"
              cs-image="member.picturePath"
              on-remove="$ctrl.removeMembers(member)">
            </cs-card-member>
          </cs-card-layout>
        </div>
        <div class="pg-footer">
          <span class="member-count">
                      {{$ctrl.getUserCount() + ('pagingGroup.users' | translate)}}
                  </span>
          <a class="line-show-more-less-text" ng-click="$ctrl.showMoreClicked('USER_REAL_USER', 'MEMBER')" ng-show="$ctrl.showMoreButton('USER_REAL_USER', 'MEMBER')">
            <span translate="telephonyPreview.showMore"></span>
          </a>
          <a class="line-show-more-less-text" ng-click="$ctrl.showLessClicked('USER_REAL_USER', 'MEMBER')" ng-show="$ctrl.showLessButton('USER_REAL_USER', 'MEMBER')">
            <span translate="telephonyPreview.showLess"></span>
          </a>
        </div>

        <h5 class="sub-section__label" translate='tabs.placeTab'></h5>
        <div>
          <cs-card-layout>
            <cs-card-member
              ng-repeat="member in $ctrl.listOfDisplayMembers | filter: {member: {'type': 'USER_PLACE'}} | limitTo:$ctrl.numberOfCardsPlaces"
              cs-type="simple"
              cs-member-type="{{$ctrl.getMemberType(member.member)}}"
              cs-id="member.member.uuid"
              cs-title="$ctrl.getDisplayNameOnCard(member.member)"
              cs-subtitle="member.member.userName"
              cs-image="member.picturePath"
              on-remove="$ctrl.removeMembers(member)">
            </cs-card-member>
          </cs-card-layout>
        </div>
        <div class="pg-footer">
          <span class="member-count">
                      {{$ctrl.getPlaceCount() + ('pagingGroup.places' | translate)}}
                  </span>
          <a class="line-show-more-less-text" ng-click="$ctrl.showMoreClicked('USER_PLACE', 'MEMBER')" ng-show="$ctrl.showMoreButton('USER_PLACE', 'MEMBER')">
            <span translate="telephonyPreview.showMore"></span>
          </a>
          <a class="line-show-more-less-text" ng-click="$ctrl.showLessClicked('USER_PLACE', 'MEMBER')" ng-show="$ctrl.showLessButton('USER_PLACE', 'MEMBER')">
            <span translate="telephonyPreview.showLess"></span>
          </a>
        </div>
      </div>
    </div>
    <div class="cs-form__section cs-form__section--member">
      <div class="section__info">
        <h4 class="section__title" translate="pagingGroup.pagingGroupInitiator"></h4>
        <h6 class="section__description" translate="pagingGroup.initiatorEditHint"></h6>
      </div>
      <div class="section__content">
        <div class="cs-radio-group"> 
          <input cs-input type="radio" 
             ng-model="$ctrl.initiatorType" 
             name="allRadio" 
             ng-change="$ctrl.onChange()"
             id="public" 
             value="PUBLIC"
             ng-change="$ctrl.onChange()"
             cs-input-label="{{:: 'pagingGroup.all' | translate}}">
         <input cs-input type="radio" 
             ng-model="$ctrl.initiatorType" 
             id="membersonly" 
             ng-change="$ctrl.onChange()"
             name="allMembersRadio" 
             value="MEMBERS_ONLY"
             ng-change="$ctrl.onChange()"
             cs-input-label="{{:: 'pagingGroup.allMembers' | translate}}">
         <input cs-input type="radio" 
             ng-model="$ctrl.initiatorType" 
             id="custom" 
             ng-change="$ctrl.onChange()"
             name="customRadio" 
             value="CUSTOM"
             ng-change="$ctrl.onChange()"
             cs-input-label="{{:: 'pagingGroup.custom' | translate}}">
        </div>
        <div class="pg-search-add">
          <input id="paging-group-initiator" type="text" ng-click="$ctrl.resetFilterInitiator()"  ng-model="$ctrl.initiatorName"class="cs-input"
            ng-disabled="$ctrl.initiatorType!=='CUSTOM'" typeahead="mem as $ctrl.getDisplayNameInDropdown(mem) for mem in $ctrl.fetchMembers('INITIATOR') | limitTo: 10" typeahead-template-url="userTemplate.html"
            typeahead-on-select="$ctrl.selectInitiators($item)" placeholder="{{:: 'pagingGroup.editInitiatorPlaceholder' | translate}}"
            typeahead-min-length="3" typeahead-wait-ms="200">
          <div class="search-member">
            <i class="icon icon-search" ng-disabled="$ctrl.initiatorType!=='CUSTOM'"></i>
            <input id="search-initiator-box" ng-disabled="$ctrl.initiatorType!=='CUSTOM'" type="text" placeholder="{{'pagingGroup.searchInitiators' | translate}}" ng-model="$ctrl.searchStrInitiator" ng-change="$ctrl.filterListInitiator()">
          </div>
        </div>
        <div>
          <cs-card-layout>
            <cs-card-member
              ng-repeat="member in $ctrl.listOfDisplayInitiators | limitTo:$ctrl.numberOfCardsInitiators"
              ng-hide="$ctrl.initiatorType!=='CUSTOM'"
              cs-type="simple"
              cs-member-type="{{$ctrl.getMemberType(member.member)}}"
              cs-id="member.member.uuid"
              cs-title="$ctrl.getDisplayNameOnCard(member.member)"
              cs-subtitle="member.member.userName"
              cs-image="member.picturePath"
              on-remove="$ctrl.removeInitiators(member)">
            </cs-card-member>
          </cs-card-layout>
        </div>
        <div class="pg-footer">
          <span class="member-count" ng-hide="$ctrl.initiatorType!=='CUSTOM'">
                      {{$ctrl.initiatorCount + ('pagingGroup.initiators' | translate)}}
          </span>
          <a class="line-show-more-less-text" ng-click="$ctrl.showMoreClicked('', 'INITIATOR')" ng-show="$ctrl.showMoreButton('', 'INITIATOR')">
            <span translate="telephonyPreview.showMore"></span>
          </a>
          <a class="line-show-more-less-text" ng-click="$ctrl.showLessClicked('', 'INITIATOR')" ng-show="$ctrl.showLessButton('', 'INITIATOR')">
            <span translate="telephonyPreview.showLess"></span>
          </a>
        </div>        
      </div>
    </div>
  </form>
</div>

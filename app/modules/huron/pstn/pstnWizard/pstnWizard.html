<!-- PSTN Trial Modal -->

<!-- header -->
<div class="modal-header">
  <button type="button" class="close" ng-click="$ctrl.dismissModal()" aria-label="{{::'common.close' | translate}}"></button>
  <h3 class="modal-title">{{$ctrl.titles[$ctrl.step]}}</h3>
</div>

<!-- body -->
<div class="modal-body" ng-class="{trials: $ctrl.step === 4}">
  <div ng-if="$ctrl.step === 1">
    <uc-pstn-providers
      ng-if="$ctrl.enableCarriers"
      ng-show="$ctrl.showCarriers"
      on-change-fn="$ctrl.onProviderChange()"
      on-ready-fn="$ctrl.onProviderReady()">
    </uc-pstn-providers>
  </div>
  <div class="row collapse" ng-if="$ctrl.step === 2">
    <h3 translate="pstnContractInformation.title"></h3>
    <p translate="pstnContractInformation.prompt"></p>
    <br>
    <form name="$ctrl.wizardForm2">
      <uc-pstn-contact-info class="columns medium-6" contact="$ctrl.contact"></uc-pstn-contact-info>
    </form>
  </div>
  <div ng-if="$ctrl.step === 3">
    <emergency-services
      address="$ctrl.address"
      country-code="$ctrl.countryCode"
      validation="$ctrl.address.validated"
      address-loading="$ctrl.loading"
      address-found="$ctrl.address.validated"
      reset-address="$ctrl.resetAddress()"
      read-only="$ctrl.address.validated"
      validate-address="$ctrl.validateAddress()"
      show-validation="true">
    </emergency-services>
  </div>
  <div ng-if="$ctrl.step === 4" class="pstn-selector-container">
    <div class="flex-container">
      <cs-tabset class="flex-2" justified="false">
        <cs-tab>
          <cs-tab-heading translate="pstnSetup.newNumbersTab"></cs-tab-heading>
          <p translate="pstnSetup.newNumbersTabDesc"></p>
          <uc-pstn-number-search
            model="$ctrl.model.pstn"
            search="$ctrl.searchCarrierInventory(value, block, quantity, consecutive, stateAbbreviation)"
            add-to-cart="$ctrl.addToCart(order_type, number_type, quantity, searchResultModel)"
            country-code="$ctrl.countryCode">
          </uc-pstn-number-search>
        </cs-tab>
        <cs-tab ng-if="$ctrl.showTollFreeNumbers">
          <cs-tab-heading translate="pstnSetup.newTollFreeTab"></cs-tab-heading>
          <div class="numbers-new" ng-if="!$ctrl.showOrderForm()">
            <div translate="pstnSetup.unableToAddTollFreeNumbersShort"></div>
            <a href translate="pstnSetup.initContract" translate-value-carrier="{{$ctrl.carrierName}}" ng-click="$ctrl.sendContract()"></a>
          </div>
          <div ng-if="$ctrl.showOrderForm()">
            <div ng-if="!$ctrl.showContractUnSigned()">
              <p>{{$ctrl.tollFreeTitle}}</p>
              <uc-pstn-number-search
                model="$ctrl.model.tollFree"
                search="$ctrl.searchCarrierTollFreeInventory(value, block, quantity, consecutive)"
                add-to-cart="$ctrl.addToCart(order_type, number_type, quantity, searchResultModel)"
                country-code="$ctrl.countryCode"
                number-type="TOLLFREE">
              </uc-pstn-number-search>
            </div>
            <div ng-if="$ctrl.showContractUnSigned()">
              <span translate="pstnSetup.unableToAddTollFreeNumbers"></span>
            </div>
          </div>
        </cs-tab>
        <cs-tab ng-if="$ctrl.showPortNumbers">
          <cs-tab-heading translate="pstnSetup.portNumbersTab"></cs-tab-heading>
          <div class="numbers-new" ng-if="!$ctrl.showOrderForm()">
            <div translate="pstnSetup.unableToAddPortedNumbersShort"></div>
            <a href translate="pstnSetup.initContract" translate-value-carrier="{{$ctrl.carrierName}}" ng-click="$ctrl.sendContract()"></a>
          </div>
          <div ng-if="$ctrl.showOrderForm()">
            <div ng-if="!$ctrl.showContractUnSigned()">
              <div class="provider-flex">
                <p translate="pstnSetup.portNumbersPrompt"></p>
                <button type="button" class="btn btn--people" ng-disabled="$ctrl.validCount < 1 || $ctrl.invalidCount > 0" ng-click="$ctrl.addToCart('PORT_ORDER')"><span translate="common.add"></span></button>
              </div>
              <cs-token-field class="port-numbers"
                tokens="$ctrl.unsavedTokens"
                tokenfieldid="$ctrl.tokenfieldId"
                tokenplacehoder="$ctrl.tokenplacehoder"
                tokenoptions="$ctrl.tokenoptions"
                tokenmethods="$ctrl.tokenmethods">
              </cs-token-field>
              <div class="warning-message" ng-if="$ctrl.invalidCount > 0">
                <span class="icon icon-error"></span><p translate="pstnSetup.invalidNumberPrompt"></p>
              </div>
            </div>
            <div ng-if="$ctrl.showContractUnSigned()">
              <span translate="pstnSetup.unableToAddPortedNumbers"></span>
            </div>
          </div>
        </cs-tab>
      </cs-tabset>
      <section class="flex-1">
        <div class="provider-flex center"><h1 class="h5" translate="pstnSetup.numberCart"></h1><h1 class="h4"><span class="badge badge--round info">{{$ctrl.getOrderNumbersTotal()}}</span></h1></div>
        <ul class="list-group">
          <li class="list-group-item list-token info" ng-repeat="order in $ctrl.orderCart">
            <span>{{::$ctrl.formatTelephoneNumber(order)}}</span>
            <span ng-if="::$ctrl.showOrderQuantity(order);">{{::'pstnSetup.quantity' | translate}} {{$ctrl.getOrderQuantity(order)}}</span>
            <button type="button" class="close" ng-click="$ctrl.removeOrder(order)" aria-label="{{::'common.delete' | translate}}"></button>
          </li>
        </ul>
      </section>
    </div>
  </div>
  <div ng-if="$ctrl.step === 5">
    <uc-pstn-swivel-numbers
      numbers="$ctrl.swivelNumbers"
      acknowledge="$ctrl.emergencyAcknowledge"
      on-change="$ctrl.onSwivelChange(numbers, invalidCount)"
      on-acknowledge="$ctrl.onAcknowledge(value)">
    </uc-pstn-swivel-numbers>
  </div>
  <div ng-if="$ctrl.step === 6" class="pstn-review">
    <uc-pstn-review ng-if="$ctrl.ftHI1635">
    </uc-pstn-review>
    <div class="review-container" ng-if="!$ctrl.ftHI1635">
      <i class="icon icon-circle-call"></i>
      <h1 class="title" translate="pstnSetup.reviewAndOrder"></h1>
      <div class="review-details">
        <div class="logo">
          <img class="right" ng-src="{{::$ctrl.provider.logoSrc}}" alt="{{::$ctrl.provider.logoAlt}}">
        </div>
        <div class="package-details">
          <div class="package-detail-label">
            <div translate="pstnSetup.package"></div>
            <div translate="pstnSetup.numbersTitle"></div>
          </div>
          <div class="package-detail-text">
            <div>{{::$ctrl.provider.title}}</div>
            <div class="detail-text" ng-if="$ctrl.totalNewAdvancedOrder" translate="pstnSetup.newNumbers" translate-value-count="{{::$ctrl.totalNewAdvancedOrder}}"></div>
            <div class="detail-text" ng-if="$ctrl.totalPortNumbers" translate="pstnSetup.portNumbers" translate-value-count="{{::$ctrl.totalPortNumbers}}"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div ng-if="$ctrl.step === 7" class="pstn-next-steps">
    <div class="flex-container">
      <i class="icon icon-check-mark-success"></i>
      <h3 translate="pstnSetup.thankYou"></h3>
      <h2 translate="pstnSetup.OrderSubmitted"></h2>
      <h2>
      <span ng-hide="$ctrl.isTrial || $ctrl.pstnOrders.length > 1"><i class="icon icon-information left"></i><span class="h5 left" translate="pstnSetup.nextStepPrompt1"></span></span>
      <span ng-show="$ctrl.portOrders.length"><i class="icon icon-information left"></i><span class="h5 left" translate="pstnSetup.nextStepPrompt2"></span></span>
      </h2>
      <div>
        <button class="left btn btn--people" ng-click="$ctrl.launchCustomerPortal()" translate="pstnSetup.launchPortal">
        </button>
      </div>
    </div>
  </div>
  <div ng-if="$ctrl.step === 8" >
    <div class="flex-container">
      <uc-esa-disclaimer-msg></uc-esa-disclaimer-msg>
    </div>
  </div>
  <div ng-if="$ctrl.step === 9" >
    <div ng-if="$ctrl.blockByopNumberAddForPartnerAdmin" class="adding-phone-number-blocked">
      <div><i class="icon icon-warning"></i></div><div><h1 class="h4" translate="pstnSetup.addByopNumberBlocked.title"></h1></div>
      <div class="clearfix"></div>
      <p id='addByopNumberBlockedMessageMain' translate="pstnSetup.addByopNumberBlocked.messageMain"></p>
      <p translate="pstnSetup.addByopNumberBlocked.messageSkip"></p>
    </div>
    <uc-pstn-swivel-numbers
      ng-if="!$ctrl.blockByopNumberAddForPartnerAdmin"
      numbers="$ctrl.swivelNumbers"
      acknowledge="$ctrl.emergencyAcknowledge"
      on-change="$ctrl.onSwivelChange(numbers, invalidCount)"
      on-acknowledge="$ctrl.onAcknowledge(value)">
    </uc-pstn-swivel-numbers>
  </div>
  <div ng-if="$ctrl.step === 10" class="pstn-review swivel-pstn-review">
    <div class="review-container">
      <i class="icon icon-circle-call"></i>
      <h1 class="title" translate="pstnSetup.reviewSummary"></h1>
      <div class="review-details">
        <div class="swivel-package-details">
          <div class="package-detail-label">
            <div translate="pstnSetup.pstnMethod"></div>
            <div class="detail-text" translate="pstnSetup.privatePstnTrunk" ></div>
            <div translate="pstnSetup.numbersTitle"></div>
            <div class="detail-text" translate="pstnSetup.importNumbersTitle" translate-value-count="{{::$ctrl.swivelNumbers.length}}" translate-interpolation="messageformat"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div ng-if="$ctrl.step === 11" class="pstn-next-steps">
    <div class="flex-container swivel-pstn-next-steps">
      <i class="icon icon-check-mark-success"></i>
      <h3 translate="pstnSetup.thankYou"></h3>
      <h2 ng-if="$ctrl.swivelNumbers.length === 0" translate="pstnSetup.privatePstnFinalized"></h2>
      <h2 ng-if="$ctrl.swivelNumbers.length !== 0" translate="pstnSetup.privatePstnNumbersImported" translate-value-count="{{::$ctrl.swivelNumbers.length}}" translate-interpolation="messageformat"></h2>
      <div ng-if="$ctrl.swivelNumbers.length !== 0">
        <button ng-if="$ctrl.loggedInPartnerPortal" class="left btn btn--people" ng-click="$ctrl.launchCustomerPortal()" translate="pstnSetup.launchPortal">
        </button>
      </div>
    </div>
  </div>
</div>

<!-- footer -->
<div class="modal-footer trials" ng-if="$ctrl.showButtons">
  <button ng-show="$ctrl.showSkipBtn()" class="skip-btn btn btn--link btn--none no-animate"
    ng-click="$ctrl.onSkip()"
    translate="trialModal.skip">
  </button>
  <button ng-hide="$ctrl.hideBackBtn()" class="btn with-slim-offset offset-l no-animate"
    ng-click="$ctrl.previousStep()"
    translate="common.back">
  </button>
  <button id="wizardBtn" class="btn btn--primary" type="button" cs-btn loading="$ctrl.placeOrderLoad"
    ng-click="$ctrl.nextStep()" ng-disabled="$ctrl.nextDisabled()">
    <span ng-if="$ctrl.step === 6" translate="pstnSetup.placeOrder"></span>
    <span ng-if="$ctrl.step === 7 || $ctrl.step === 11" translate="common.done"></span>
    <span ng-if="!($ctrl.step === 6 || $ctrl.step === 7 || $ctrl.step === 8 || $ctrl.step === 10 || $ctrl.step === 11)" translate="common.next"></span>
    <span ng-if="$ctrl.step === 8" translate="common.agree"></span>
    <span ng-if="$ctrl.step === 10 && $ctrl.swivelNumbers.length === 0" translate="pstnSetup.finalizePstn"></span>
    <span ng-if="$ctrl.step === 10 && $ctrl.swivelNumbers.length !== 0" translate="pstnSetup.importNumbers"></span>
  </button>
</div>
